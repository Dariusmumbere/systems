<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rural United Real Estates - Savings & Credit</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Global Styles */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --gray-color: #95a5a6;
            --light-gray: #bdc3c7;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Header Styles */
        header {
            background-color: var(--dark-color);
            color: white;
            width: 250px;
            min-height: 100vh;
            padding: 20px 0;
            position: fixed;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo i {
            font-size: 2rem;
            margin-right: 10px;
        }

        .logo h1 {
            font-size: 1.2rem;
            font-weight: 600;
        }

        nav ul {
            list-style: none;
            margin-top: 20px;
        }

        nav ul li a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--light-color);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        nav ul li a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        nav ul li a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        nav ul li a.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Hamburger Menu */
        .hamburger {
            display: none;
            cursor: pointer;
            padding: 15px;
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 101;
            background-color: var(--dark-color);
            border-radius: var(--border-radius);
        }

        .hamburger i {
            color: white;
            font-size: 1.5rem;
        }

        /* Main Content Styles */
        main {
            flex: 1;
            margin-left: 250px;
            padding: 30px;
            transition: margin-left 0.3s ease;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        h2 {
            color: var(--dark-color);
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
        }

        h2 i {
            margin-right: 10px;
        }

        h3 {
            color: var(--dark-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .stat-card h3 {
            color: var(--gray-color);
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: var(--shadow);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status.active {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
        }

        .status.paid {
            background-color: rgba(52, 152, 219, 0.2);
            color: var(--primary-color);
        }

        .status.defaulted {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--danger-color);
        }

        .status.inactive {
            background-color: rgba(149, 165, 166, 0.2);
            color: var(--gray-color);
        }

        /* Buttons */
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn i {
            margin-right: 5px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-secondary {
            background-color: var(--gray-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* Search and Filters */
        .search-filter {
            margin-bottom: 20px;
        }

        .search-filter input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filters select, .filters input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
        }

        .modal-content.small {
            max-width: 400px;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
        }

        .close:hover {
            color: var(--dark-color);
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Report Cards */
        .report-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .report-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .report-card i {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .report-card h3 {
            color: var(--dark-color);
            margin-bottom: 0;
        }

        .report-results {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            min-height: 300px;
        }

        /* Responsive */
        @media (max-width: 992px) {
            header {
                transform: translateX(-100%);
            }

            header.active {
                transform: translateX(0);
            }

            main {
                margin-left: 0;
            }

            .hamburger {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .stats-container {
                grid-template-columns: 1fr 1fr;
            }

            table {
                display: block;
                overflow-x: auto;
            }
        }

        @media (max-width: 480px) {
            .stats-container {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="hamburger" id="hamburger">
        <i class="fas fa-bars"></i>
    </div>

    <div class="container">
        <header id="sidebar">
            <div class="logo">
                <i class="fas fa-hand-holding-usd"></i>
                <h1>Rural United Real Estates</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#" data-section="members"><i class="fas fa-users"></i> Members</a></li>
                    <li><a href="#" data-section="savings"><i class="fas fa-piggy-bank"></i> Savings</a></li>
                    <li><a href="#" data-section="loans"><i class="fas fa-hand-holding-usd"></i> Loans</a></li>
                    <li><a href="#" data-section="transactions"><i class="fas fa-exchange-alt"></i> Transactions</a></li>
                    <li><a href="#" data-section="reports"><i class="fas fa-chart-bar"></i> Reports</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                <div class="stats-container">
                    <div class="stat-card">
                        <h3>Total Members</h3>
                        <p id="total-members">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Savings</h3>
                        <p id="total-savings">Ugx 0.00</p>
                    </div>
                    <div class="stat-card">
                        <h3>Active Loans</h3>
                        <p id="active-loans">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Loan Balance</h3>
                        <p id="loan-balance">Ugx 0.00</p>
                    </div>
                </div>
                <div class="recent-activity">
                    <h3>Recent Activity</h3>
                    <table id="recent-transactions">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Member</th>
                                <th>Type</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Members Section -->
            <section id="members" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> Members</h2>
                    <button id="add-member-btn" class="btn-primary"><i class="fas fa-plus"></i> Add Member</button>
                </div>
                <div class="search-filter">
                    <input type="text" id="member-search" placeholder="Search members...">
                </div>
                <table id="members-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Join Date</th>
                            <th>Savings Balance</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Filled by JavaScript -->
                    </tbody>
                </table>
            </section>

            <!-- Savings Section -->
            <section id="savings" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-piggy-bank"></i> Savings</h2>
                    <button id="add-saving-btn" class="btn-primary"><i class="fas fa-plus"></i> New Transaction</button>
                </div>
                <div class="filters">
                    <select id="saving-member-filter">
                        <option value="">All Members</option>
                    </select>
                    <select id="saving-type-filter">
                        <option value="">All Types</option>
                        <option value="deposit">Deposit</option>
                        <option value="withdrawal">Withdrawal</option>
                    </select>
                    <input type="date" id="saving-date-filter">
                </div>
                <table id="savings-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Member</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Balance</th>
                            <th>Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Filled by JavaScript -->
                    </tbody>
                </table>
            </section>

            <!-- Loans Section -->
            <section id="loans" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-hand-holding-usd"></i> Loans</h2>
                    <button id="add-loan-btn" class="btn-primary"><i class="fas fa-plus"></i> New Loan</button>
                </div>
                <div class="filters">
                    <select id="loan-member-filter">
                        <option value="">All Members</option>
                    </select>
                    <select id="loan-status-filter">
                        <option value="">All Statuses</option>
                        <option value="active">Active</option>
                        <option value="paid">Paid</option>
                        <option value="defaulted">Defaulted</option>
                    </select>
                </div>
                <table id="loans-table">
                    <thead>
                        <tr>
                            <th>Loan ID</th>
                            <th>Member</th>
                            <th>Amount</th>
                            <th>Interest</th>
                            <th>Term</th>
                            <th>Start Date</th>
                            <th>Due Date</th>
                            <th>Paid</th>
                            <th>Balance</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Filled by JavaScript -->
                    </tbody>
                </table>
            </section>

            <!-- Transactions Section -->
            <section id="transactions" class="content-section">
                <h2><i class="fas fa-exchange-alt"></i> Transactions</h2>
                <div class="filters">
                    <select id="transaction-type-filter">
                        <option value="">All Types</option>
                        <option value="saving">Savings</option>
                        <option value="loan">Loan</option>
                        <option value="repayment">Repayment</option>
                    </select>
                    <input type="date" id="transaction-date-filter">
                </div>
                <table id="transactions-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Member</th>
                            <th>Amount</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Filled by JavaScript -->
                    </tbody>
                </table>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="content-section">
                <h2><i class="fas fa-chart-bar"></i> Reports</h2>
                <div class="report-options">
                    <div class="report-card" id="savings-report">
                        <i class="fas fa-piggy-bank"></i>
                        <h3>Savings Report</h3>
                    </div>
                    <div class="report-card" id="loans-report">
                        <i class="fas fa-hand-holding-usd"></i>
                        <h3>Loans Report</h3>
                    </div>
                    <div class="report-card" id="members-report">
                        <i class="fas fa-users"></i>
                        <h3>Members Report</h3>
                    </div>
                </div>
                <div class="report-results" id="report-results">
                    <p>Select a report to generate</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div id="member-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="member-modal-title">Add New Member</h2>
            <form id="member-form">
                <input type="hidden" id="member-id">
                <div class="form-group">
                    <label for="member-name">Full Name</label>
                    <input type="text" id="member-name" required>
                </div>
                <div class="form-group">
                    <label for="member-phone">Phone Number</label>
                    <input type="tel" id="member-phone" required>
                </div>
                <div class="form-group">
                    <label for="member-email">Email</label>
                    <input type="email" id="member-email">
                </div>
                <div class="form-group">
                    <label for="member-address">Address</label>
                    <textarea id="member-address" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="member-id-number">ID Number</label>
                    <input type="text" id="member-id-number" required>
                </div>
                <div class="form-group">
                    <label for="member-join-date">Join Date</label>
                    <input type="date" id="member-join-date" required>
                </div>
                <button type="submit" class="btn-primary">Save Member</button>
            </form>
        </div>
    </div>

    <div id="saving-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="saving-modal-title">New Savings Transaction</h2>
            <form id="saving-form">
                <input type="hidden" id="saving-id">
                <div class="form-group">
                    <label for="saving-member">Member</label>
                    <select id="saving-member" required>
                        <option value="">Select Member</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="saving-type">Transaction Type</label>
                    <select id="saving-type" required>
                        <option value="deposit">Deposit</option>
                        <option value="withdrawal">Withdrawal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="saving-amount">Amount</label>
                    <input type="number" id="saving-amount" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="saving-date">Date</label>
                    <input type="date" id="saving-date" required>
                </div>
                <div class="form-group">
                    <label for="saving-notes">Notes</label>
                    <textarea id="saving-notes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn-primary">Save Transaction</button>
            </form>
        </div>
    </div>

    <div id="loan-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="loan-modal-title">New Loan</h2>
            <form id="loan-form">
                <input type="hidden" id="loan-id">
                <div class="form-group">
                    <label for="loan-member">Member</label>
                    <select id="loan-member" required>
                        <option value="">Select Member</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="loan-amount">Amount</label>
                    <input type="number" id="loan-amount" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="loan-interest">Interest Rate (%)</label>
                    <input type="number" id="loan-interest" min="0" max="100" step="0.01" value="10" required>
                </div>
                <div class="form-group">
                    <label for="loan-term">Term (months)</label>
                    <input type="number" id="loan-term" min="1" max="36" value="12" required>
                </div>
                <div class="form-group">
                    <label for="loan-start-date">Start Date</label>
                    <input type="date" id="loan-start-date" required>
                </div>
                <div class="form-group">
                    <label for="loan-purpose">Purpose</label>
                    <textarea id="loan-purpose" rows="3"></textarea>
                </div>
                <button type="submit" class="btn-primary">Save Loan</button>
            </form>
        </div>
    </div>

    <div id="repayment-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Loan Repayment</h2>
            <form id="repayment-form">
                <input type="hidden" id="repayment-loan-id">
                <div class="form-group">
                    <label for="repayment-amount">Amount</label>
                    <input type="number" id="repayment-amount" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="repayment-date">Date</label>
                    <input type="date" id="repayment-date" required>
                </div>
                <div class="form-group">
                    <label for="repayment-notes">Notes</label>
                    <textarea id="repayment-notes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn-primary">Record Repayment</button>
            </form>
        </div>
    </div>

    <div id="confirmation-modal" class="modal">
        <div class="modal-content small">
            <h2 id="confirmation-title">Confirm Action</h2>
            <p id="confirmation-message">Are you sure you want to perform this action?</p>
            <div class="modal-buttons">
                <button id="confirm-cancel" class="btn-secondary">Cancel</button>
                <button id="confirm-ok" class="btn-danger">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // Data Structure
        let members = JSON.parse(localStorage.getItem('members')) || [];
        let savings = JSON.parse(localStorage.getItem('savings')) || [];
        let loans = JSON.parse(localStorage.getItem('loans')) || [];
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

        // DOM Elements
        const sections = document.querySelectorAll('.content-section');
        const navLinks = document.querySelectorAll('nav ul li a');
        const memberForm = document.getElementById('member-form');
        const savingForm = document.getElementById('saving-form');
        const loanForm = document.getElementById('loan-form');
        const repaymentForm = document.getElementById('repayment-form');
        const confirmationModal = document.getElementById('confirmation-modal');
        const confirmOkBtn = document.getElementById('confirm-ok');
        const confirmCancelBtn = document.getElementById('confirm-cancel');
        const hamburger = document.getElementById('hamburger');
        const sidebar = document.getElementById('sidebar');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            loadMembers();
            loadSavings();
            loadLoans();
            loadTransactions();
            setupEventListeners();
            updateMemberSelects();
        });

        // Hamburger menu toggle
        hamburger.addEventListener('click', function() {
            sidebar.classList.toggle('active');
            const icon = hamburger.querySelector('i');
            if (sidebar.classList.contains('active')) {
                icon.classList.remove('fa-bars');
                icon.classList.add('fa-times');
            } else {
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
            }
        });

        // Close sidebar when clicking on a nav link (for mobile)
        navLinks.forEach(link => {
            link.addEventListener('click', function() {
                if (window.innerWidth <= 992) {
                    sidebar.classList.remove('active');
                    hamburger.querySelector('i').classList.remove('fa-times');
                    hamburger.querySelector('i').classList.add('fa-bars');
                }
            });
        });

        // Event Listeners
        function setupEventListeners() {
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');
                    showSection(sectionId);
                    
                    // Update active nav link
                    navLinks.forEach(navLink => navLink.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Member Form
            memberForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveMember();
            });

            // Saving Form
            savingForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveSaving();
            });

            // Loan Form
            loanForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveLoan();
            });

            // Repayment Form
            repaymentForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveRepayment();
            });

            // Add Member Button
            document.getElementById('add-member-btn').addEventListener('click', function() {
                showMemberModal();
            });

            // Add Saving Button
            document.getElementById('add-saving-btn').addEventListener('click', function() {
                showSavingModal();
            });

            // Add Loan Button
            document.getElementById('add-loan-btn').addEventListener('click', function() {
                showLoanModal();
            });

            // Member Search
            document.getElementById('member-search').addEventListener('input', function() {
                filterMembers(this.value);
            });

            // Saving Filters
            document.getElementById('saving-member-filter').addEventListener('change', function() {
                filterSavings();
            });
            document.getElementById('saving-type-filter').addEventListener('change', function() {
                filterSavings();
            });
            document.getElementById('saving-date-filter').addEventListener('change', function() {
                filterSavings();
            });

            // Loan Filters
            document.getElementById('loan-member-filter').addEventListener('change', function() {
                filterLoans();
            });
            document.getElementById('loan-status-filter').addEventListener('change', function() {
                filterLoans();
            });

            // Transaction Filters
            document.getElementById('transaction-type-filter').addEventListener('change', function() {
                filterTransactions();
            });
            document.getElementById('transaction-date-filter').addEventListener('change', function() {
                filterTransactions();
            });

            // Report Cards
            document.getElementById('savings-report').addEventListener('click', function() {
                generateSavingsReport();
            });
            document.getElementById('loans-report').addEventListener('click', function() {
                generateLoansReport();
            });
            document.getElementById('members-report').addEventListener('click', function() {
                generateMembersReport();
            });

            // Confirmation Modal
            confirmCancelBtn.addEventListener('click', function() {
                confirmationModal.style.display = 'none';
            });

            // Close modals when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
        }

        // Section Navigation
        function showSection(sectionId) {
            sections.forEach(section => {
                section.classList.remove('active');
                if (section.id === sectionId) {
                    section.classList.add('active');
                    
                    // Refresh section data when shown
                    switch(sectionId) {
                        case 'dashboard':
                            loadDashboard();
                            break;
                        case 'members':
                            loadMembers();
                            break;
                        case 'savings':
                            loadSavings();
                            break;
                        case 'loans':
                            loadLoans();
                            break;
                        case 'transactions':
                            loadTransactions();
                            break;
                    }
                }
            });
        }

        // Dashboard Functions
        function loadDashboard() {
            // Total Members
            document.getElementById('total-members').textContent = members.length;
            
            // Total Savings
            const totalSavings = savings.reduce((sum, saving) => {
                if (saving.type === 'deposit') return sum + saving.amount;
                if (saving.type === 'withdrawal') return sum - saving.amount;
                return sum;
            }, 0);
            document.getElementById('total-savings').textContent = formatCurrency(totalSavings);
            
            // Active Loans
            const activeLoans = loans.filter(loan => loan.status === 'active').length;
            document.getElementById('active-loans').textContent = activeLoans;
            
            // Loan Balance
            const loanBalance = loans.reduce((sum, loan) => {
                if (loan.status === 'active') return sum + (loan.amount - (loan.paid || 0));
                return sum;
            }, 0);
            document.getElementById('loan-balance').textContent = formatCurrency(loanBalance);
            
            // Recent Transactions
            const recentTransactions = [...transactions]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            const tbody = document.querySelector('#recent-transactions tbody');
            tbody.innerHTML = '';
            
            recentTransactions.forEach(transaction => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>${getMemberName(transaction.memberId)}</td>
                    <td>${transaction.type}</td>
                    <td>${formatCurrency(transaction.amount)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Member Functions
        function loadMembers() {
            const tbody = document.querySelector('#members-table tbody');
            tbody.innerHTML = '';
            
            members.forEach(member => {
                const savingsBalance = getMemberSavingsBalance(member.id);
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${member.id}</td>
                    <td>${member.name}</td>
                    <td>${member.phone}</td>
                    <td>${formatDate(member.joinDate)}</td>
                    <td>${formatCurrency(savingsBalance)}</td>
                    <td><span class="status active">Active</span></td>
                    <td>
                        <button class="btn btn-primary btn-sm edit-member" data-id="${member.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm delete-member" data-id="${member.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-member').forEach(btn => {
                btn.addEventListener('click', function() {
                    const memberId = this.getAttribute('data-id');
                    editMember(memberId);
                });
            });
            
            document.querySelectorAll('.delete-member').forEach(btn => {
                btn.addEventListener('click', function() {
                    const memberId = this.getAttribute('data-id');
                    confirmAction(
                        'Delete Member',
                        'Are you sure you want to delete this member? This action cannot be undone.',
                        () => deleteMember(memberId)
                    );
                });
            });
        }

        function filterMembers(searchTerm) {
            const rows = document.querySelectorAll('#members-table tbody tr');
            searchTerm = searchTerm.toLowerCase();
            
            rows.forEach(row => {
                const name = row.cells[1].textContent.toLowerCase();
                const phone = row.cells[2].textContent.toLowerCase();
                
                if (name.includes(searchTerm) || phone.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function showMemberModal(member = null) {
            const modal = document.getElementById('member-modal');
            const title = document.getElementById('member-modal-title');
            const form = document.getElementById('member-form');
            
            if (member) {
                title.textContent = 'Edit Member';
                document.getElementById('member-id').value = member.id;
                document.getElementById('member-name').value = member.name;
                document.getElementById('member-phone').value = member.phone;
                document.getElementById('member-email').value = member.email || '';
                document.getElementById('member-address').value = member.address || '';
                document.getElementById('member-id-number').value = member.idNumber || '';
                document.getElementById('member-join-date').value = member.joinDate;
            } else {
                title.textContent = 'Add New Member';
                form.reset();
                document.getElementById('member-join-date').value = new Date().toISOString().split('T')[0];
            }
            
            modal.style.display = 'flex';
            
            // Close modal when clicking on X
            modal.querySelector('.close').addEventListener('click', function() {
                modal.style.display = 'none';
            });
        }

        function saveMember() {
            const id = document.getElementById('member-id').value;
            const name = document.getElementById('member-name').value;
            const phone = document.getElementById('member-phone').value;
            const email = document.getElementById('member-email').value;
            const address = document.getElementById('member-address').value;
            const idNumber = document.getElementById('member-id-number').value;
            const joinDate = document.getElementById('member-join-date').value;
            
            const memberData = {
                name,
                phone,
                email,
                address,
                idNumber,
                joinDate
            };
            
            if (id) {
                // Update existing member
                const index = members.findIndex(m => m.id === id);
                if (index !== -1) {
                    members[index] = { ...members[index], ...memberData };
                }
            } else {
                // Add new member
                memberData.id = generateId();
                members.push(memberData);
            }
            
            saveData();
            document.getElementById('member-modal').style.display = 'none';
            loadMembers();
            loadDashboard();
            updateMemberSelects();
        }

        function editMember(id) {
            const member = members.find(m => m.id === id);
            if (member) {
                showMemberModal(member);
            }
        }

        function deleteMember(id) {
            members = members.filter(m => m.id !== id);
            savings = savings.filter(s => s.memberId !== id);
            loans = loans.filter(l => l.memberId !== id);
            transactions = transactions.filter(t => t.memberId !== id);
            
            saveData();
            loadMembers();
            loadSavings();
            loadLoans();
            loadTransactions();
            loadDashboard();
            updateMemberSelects();
        }

        // Savings Functions
        function loadSavings() {
            const tbody = document.querySelector('#savings-table tbody');
            tbody.innerHTML = '';
            
            savings.forEach(saving => {
                const member = members.find(m => m.id === saving.memberId);
                const memberName = member ? member.name : 'Unknown';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formatDate(saving.date)}</td>
                    <td>${memberName}</td>
                    <td>${saving.type.charAt(0).toUpperCase() + saving.type.slice(1)}</td>
                    <td>${formatCurrency(saving.amount)}</td>
                    <td>${formatCurrency(getMemberSavingsBalanceAtDate(saving.memberId, saving.date))}</td>
                    <td>${saving.notes || ''}</td>
                    <td>
                        <button class="btn btn-primary btn-sm edit-saving" data-id="${saving.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm delete-saving" data-id="${saving.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-saving').forEach(btn => {
                btn.addEventListener('click', function() {
                    const savingId = this.getAttribute('data-id');
                    editSaving(savingId);
                });
            });
            
            document.querySelectorAll('.delete-saving').forEach(btn => {
                btn.addEventListener('click', function() {
                    const savingId = this.getAttribute('data-id');
                    confirmAction(
                        'Delete Transaction',
                        'Are you sure you want to delete this savings transaction?',
                        () => deleteSaving(savingId)
                    );
                });
            });
        }

        function filterSavings() {
            const memberFilter = document.getElementById('saving-member-filter').value;
            const typeFilter = document.getElementById('saving-type-filter').value;
            const dateFilter = document.getElementById('saving-date-filter').value;
            
            const rows = document.querySelectorAll('#savings-table tbody tr');
            
            rows.forEach(row => {
                const memberId = row.cells[1].textContent;
                const type = row.cells[2].textContent.toLowerCase();
                const date = row.cells[0].textContent;
                
                const memberMatch = !memberFilter || memberId === memberFilter;
                const typeMatch = !typeFilter || type === typeFilter;
                const dateMatch = !dateFilter || date === formatDate(dateFilter);
                
                if (memberMatch && typeMatch && dateMatch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function showSavingModal(saving = null) {
            const modal = document.getElementById('saving-modal');
            const title = document.getElementById('saving-modal-title');
            const form = document.getElementById('saving-form');
            
            if (saving) {
                title.textContent = 'Edit Savings Transaction';
                document.getElementById('saving-id').value = saving.id;
                document.getElementById('saving-member').value = saving.memberId;
                document.getElementById('saving-type').value = saving.type;
                document.getElementById('saving-amount').value = saving.amount;
                document.getElementById('saving-date').value = saving.date;
                document.getElementById('saving-notes').value = saving.notes || '';
            } else {
                title.textContent = 'New Savings Transaction';
                form.reset();
                document.getElementById('saving-date').value = new Date().toISOString().split('T')[0];
            }
            
            modal.style.display = 'flex';
            
            // Close modal when clicking on X
            modal.querySelector('.close').addEventListener('click', function() {
                modal.style.display = 'none';
            });
        }

        function saveSaving() {
            const id = document.getElementById('saving-id').value;
            const memberId = document.getElementById('saving-member').value;
            const type = document.getElementById('saving-type').value;
            const amount = parseFloat(document.getElementById('saving-amount').value);
            const date = document.getElementById('saving-date').value;
            const notes = document.getElementById('saving-notes').value;
            
            const savingData = {
                memberId,
                type,
                amount,
                date,
                notes
            };
            
            if (id) {
                // Update existing saving
                const index = savings.findIndex(s => s.id === id);
                if (index !== -1) {
                    savings[index] = { ...savings[index], ...savingData };
                }
            } else {
                // Add new saving
                savingData.id = generateId();
                savings.push(savingData);
                
                // Add to transactions
                transactions.push({
                    id: generateId(),
                    type: 'saving',
                    memberId,
                    amount: type === 'deposit' ? amount : -amount,
                    date,
                    description: `${type === 'deposit' ? 'Savings deposit' : 'Savings withdrawal'}${notes ? ': ' + notes : ''}`
                });
            }
            
            saveData();
            document.getElementById('saving-modal').style.display = 'none';
            loadSavings();
            loadDashboard();
            loadTransactions();
        }

        function editSaving(id) {
            const saving = savings.find(s => s.id === id);
            if (saving) {
                showSavingModal(saving);
            }
        }

        function deleteSaving(id) {
            const saving = savings.find(s => s.id === id);
            if (saving) {
                savings = savings.filter(s => s.id !== id);
                transactions = transactions.filter(t => 
                    !(t.type === 'saving' && t.memberId === saving.memberId && t.amount === (saving.type === 'deposit' ? saving.amount : -saving.amount) && t.date === saving.date)
                );
                
                saveData();
                loadSavings();
                loadDashboard();
                loadTransactions();
            }
        }

        // Loan Functions
        function loadLoans() {
            const tbody = document.querySelector('#loans-table tbody');
            tbody.innerHTML = '';
            
            loans.forEach(loan => {
                const member = members.find(m => m.id === loan.memberId);
                const memberName = member ? member.name : 'Unknown';
                const dueDate = calculateDueDate(loan.startDate, loan.term);
                const balance = loan.amount - (loan.paid || 0);
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${loan.id}</td>
                    <td>${memberName}</td>
                    <td>${formatCurrency(loan.amount)}</td>
                    <td>${loan.interest}%</td>
                    <td>${loan.term} months</td>
                    <td>${formatDate(loan.startDate)}</td>
                    <td>${formatDate(dueDate)}</td>
                    <td>${formatCurrency(loan.paid || 0)}</td>
                    <td>${formatCurrency(balance)}</td>
                    <td><span class="status ${loan.status}">${loan.status.charAt(0).toUpperCase() + loan.status.slice(1)}</span></td>
                    <td>
                        ${loan.status === 'active' ? `
                        <button class="btn btn-primary btn-sm repay-loan" data-id="${loan.id}"><i class="fas fa-money-bill-wave"></i></button>
                        ` : ''}
                        <button class="btn btn-primary btn-sm edit-loan" data-id="${loan.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm delete-loan" data-id="${loan.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.repay-loan').forEach(btn => {
                btn.addEventListener('click', function() {
                    const loanId = this.getAttribute('data-id');
                    showRepaymentModal(loanId);
                });
            });
            
            document.querySelectorAll('.edit-loan').forEach(btn => {
                btn.addEventListener('click', function() {
                    const loanId = this.getAttribute('data-id');
                    editLoan(loanId);
                });
            });
            
            document.querySelectorAll('.delete-loan').forEach(btn => {
                btn.addEventListener('click', function() {
                    const loanId = this.getAttribute('data-id');
                    confirmAction(
                        'Delete Loan',
                        'Are you sure you want to delete this loan? All related repayments will also be deleted.',
                        () => deleteLoan(loanId)
                    );
                });
            });
        }

        function filterLoans() {
            const memberFilter = document.getElementById('loan-member-filter').value;
            const statusFilter = document.getElementById('loan-status-filter').value;
            
            const rows = document.querySelectorAll('#loans-table tbody tr');
            
            rows.forEach(row => {
                const memberId = row.cells[1].textContent;
                const status = row.cells[9].textContent.toLowerCase();
                
                const memberMatch = !memberFilter || memberId === memberFilter;
                const statusMatch = !statusFilter || status === statusFilter;
                
                if (memberMatch && statusMatch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function showLoanModal(loan = null) {
            const modal = document.getElementById('loan-modal');
            const title = document.getElementById('loan-modal-title');
            const form = document.getElementById('loan-form');
            
            if (loan) {
                title.textContent = 'Edit Loan';
                document.getElementById('loan-id').value = loan.id;
                document.getElementById('loan-member').value = loan.memberId;
                document.getElementById('loan-amount').value = loan.amount;
                document.getElementById('loan-interest').value = loan.interest;
                document.getElementById('loan-term').value = loan.term;
                document.getElementById('loan-start-date').value = loan.startDate;
                document.getElementById('loan-purpose').value = loan.purpose || '';
            } else {
                title.textContent = 'New Loan';
                form.reset();
                document.getElementById('loan-start-date').value = new Date().toISOString().split('T')[0];
            }
            
            modal.style.display = 'flex';
            
            // Close modal when clicking on X
            modal.querySelector('.close').addEventListener('click', function() {
                modal.style.display = 'none';
            });
        }

        function saveLoan() {
            const id = document.getElementById('loan-id').value;
            const memberId = document.getElementById('loan-member').value;
            const amount = parseFloat(document.getElementById('loan-amount').value);
            const interest = parseFloat(document.getElementById('loan-interest').value);
            const term = parseInt(document.getElementById('loan-term').value);
            const startDate = document.getElementById('loan-start-date').value;
            const purpose = document.getElementById('loan-purpose').value;
            
            const loanData = {
                memberId,
                amount,
                interest,
                term,
                startDate,
                purpose,
                status: 'active',
                paid: 0
            };
            
            if (id) {
                // Update existing loan
                const index = loans.findIndex(l => l.id === id);
                if (index !== -1) {
                    // Preserve paid amount and status
                    loanData.paid = loans[index].paid;
                    loanData.status = loans[index].status;
                    loans[index] = { ...loans[index], ...loanData };
                }
            } else {
                // Add new loan
                loanData.id = generateId();
                loans.push(loanData);
                
                // Add to transactions
                transactions.push({
                    id: generateId(),
                    type: 'loan',
                    memberId,
                    amount: -amount, // Negative because it's money going out
                    date: startDate,
                    description: `Loan issued${purpose ? ' for: ' + purpose : ''}`
                });
            }
            
            saveData();
            document.getElementById('loan-modal').style.display = 'none';
            loadLoans();
            loadDashboard();
            loadTransactions();
        }

        function editLoan(id) {
            const loan = loans.find(l => l.id === id);
            if (loan) {
                showLoanModal(loan);
            }
        }

        function deleteLoan(id) {
            const loan = loans.find(l => l.id === id);
            if (loan) {
                loans = loans.filter(l => l.id !== id);
                transactions = transactions.filter(t => 
                    !(t.type === 'loan' && t.memberId === loan.memberId && t.amount === -loan.amount && t.date === loan.startDate)
                );
                
                // Also remove any repayment transactions
                transactions = transactions.filter(t => 
                    !(t.type === 'repayment' && t.description.includes(`Loan ${id}`))
                );
                
                saveData();
                loadLoans();
                loadDashboard();
                loadTransactions();
            }
        }

        function showRepaymentModal(loanId) {
            const modal = document.getElementById('repayment-modal');
            const loan = loans.find(l => l.id === loanId);
            
            if (loan) {
                document.getElementById('repayment-loan-id').value = loanId;
                document.getElementById('repayment-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('repayment-amount').value = (loan.amount * (1 + loan.interest/100) / loan.term).toFixed(2);
                
                modal.style.display = 'flex';
                
                // Close modal when clicking on X
                modal.querySelector('.close').addEventListener('click', function() {
                    modal.style.display = 'none';
                });
            }
        }

        function saveRepayment() {
            const loanId = document.getElementById('repayment-loan-id').value;
            const amount = parseFloat(document.getElementById('repayment-amount').value);
            const date = document.getElementById('repayment-date').value;
            const notes = document.getElementById('repayment-notes').value;
            
            const loan = loans.find(l => l.id === loanId);
            if (loan) {
                // Update loan paid amount
                loan.paid = (loan.paid || 0) + amount;
                
                // Check if loan is fully paid
                const totalAmount = loan.amount * (1 + loan.interest/100);
                if (loan.paid >= totalAmount) {
                    loan.status = 'paid';
                    loan.paid = totalAmount; // Prevent overpayment
                }
                
                // Add repayment transaction
                transactions.push({
                    id: generateId(),
                    type: 'repayment',
                    memberId: loan.memberId,
                    amount,
                    date,
                    description: `Repayment for Loan ${loanId}${notes ? ': ' + notes : ''}`
                });
                
                saveData();
                document.getElementById('repayment-modal').style.display = 'none';
                loadLoans();
                loadDashboard();
                loadTransactions();
            }
        }

        // Transaction Functions
        function loadTransactions() {
            const tbody = document.querySelector('#transactions-table tbody');
            tbody.innerHTML = '';
            
            transactions.forEach(transaction => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1)}</td>
                    <td>${getMemberName(transaction.memberId)}</td>
                    <td>${formatCurrency(transaction.amount)}</td>
                    <td>${transaction.description}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function filterTransactions() {
            const typeFilter = document.getElementById('transaction-type-filter').value;
            const dateFilter = document.getElementById('transaction-date-filter').value;
            
            const rows = document.querySelectorAll('#transactions-table tbody tr');
            
            rows.forEach(row => {
                const type = row.cells[1].textContent.toLowerCase();
                const date = row.cells[0].textContent;
                
                const typeMatch = !typeFilter || type === typeFilter;
                const dateMatch = !dateFilter || date === formatDate(dateFilter);
                
                if (typeMatch && dateMatch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Report Functions
        function generateSavingsReport() {
            const resultsDiv = document.getElementById('report-results');
            resultsDiv.innerHTML = '<h3>Savings Report</h3>';
            
            // Total savings
            const totalSavings = savings.reduce((sum, saving) => {
                if (saving.type === 'deposit') return sum + saving.amount;
                if (saving.type === 'withdrawal') return sum - saving.amount;
                return sum;
            }, 0);
            
            resultsDiv.innerHTML += `<p><strong>Total Savings Balance:</strong> ${formatCurrency(totalSavings)}</p>`;
            
            // Savings by member
            const savingsByMember = {};
            members.forEach(member => {
                const balance = getMemberSavingsBalance(member.id);
                if (balance > 0) {
                    savingsByMember[member.name] = balance;
                }
            });
            
            if (Object.keys(savingsByMember).length > 0) {
                resultsDiv.innerHTML += '<h4>Savings by Member</h4><ul>';
                for (const [name, balance] of Object.entries(savingsByMember)) {
                    resultsDiv.innerHTML += `<li>${name}: ${formatCurrency(balance)}</li>`;
                }
                resultsDiv.innerHTML += '</ul>';
            }
            
            // Recent deposits
            const recentDeposits = savings
                .filter(s => s.type === 'deposit')
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            if (recentDeposits.length > 0) {
                resultsDiv.innerHTML += '<h4>Recent Deposits</h4><table><thead><tr><th>Date</th><th>Member</th><th>Amount</th></tr></thead><tbody>';
                recentDeposits.forEach(deposit => {
                    resultsDiv.innerHTML += `
                        <tr>
                            <td>${formatDate(deposit.date)}</td>
                            <td>${getMemberName(deposit.memberId)}</td>
                            <td>${formatCurrency(deposit.amount)}</td>
                        </tr>
                    `;
                });
                resultsDiv.innerHTML += '</tbody></table>';
            }
        }

        function generateLoansReport() {
            const resultsDiv = document.getElementById('report-results');
            resultsDiv.innerHTML = '<h3>Loans Report</h3>';
            
            // Loan statistics
            const activeLoans = loans.filter(l => l.status === 'active');
            const paidLoans = loans.filter(l => l.status === 'paid');
            const defaultedLoans = loans.filter(l => l.status === 'defaulted');
            
            resultsDiv.innerHTML += `
                <p><strong>Active Loans:</strong> ${activeLoans.length}</p>
                <p><strong>Paid Loans:</strong> ${paidLoans.length}</p>
                <p><strong>Defaulted Loans:</strong> ${defaultedLoans.length}</p>
            `;
            
            // Total loan amounts
            const totalIssued = loans.reduce((sum, loan) => sum + loan.amount, 0);
            const totalRepaid = loans.reduce((sum, loan) => sum + (loan.paid || 0), 0);
            const totalOutstanding = totalIssued - totalRepaid;
            
            resultsDiv.innerHTML += `
                <p><strong>Total Loans Issued:</strong> ${formatCurrency(totalIssued)}</p>
                <p><strong>Total Repaid:</strong> ${formatCurrency(totalRepaid)}</p>
                <p><strong>Total Outstanding:</strong> ${formatCurrency(totalOutstanding)}</p>
            `;
            
            // Active loans table
            if (activeLoans.length > 0) {
                resultsDiv.innerHTML += '<h4>Active Loans</h4><table><thead><tr><th>Member</th><th>Amount</th><th>Interest</th><th>Term</th><th>Due Date</th><th>Balance</th></tr></thead><tbody>';
                activeLoans.forEach(loan => {
                    const dueDate = calculateDueDate(loan.startDate, loan.term);
                    const balance = loan.amount - (loan.paid || 0);
                    
                    resultsDiv.innerHTML += `
                        <tr>
                            <td>${getMemberName(loan.memberId)}</td>
                            <td>${formatCurrency(loan.amount)}</td>
                            <td>${loan.interest}%</td>
                            <td>${loan.term} months</td>
                            <td>${formatDate(dueDate)}</td>
                            <td>${formatCurrency(balance)}</td>
                        </tr>
                    `;
                });
                resultsDiv.innerHTML += '</tbody></table>';
            }
        }

        function generateMembersReport() {
            const resultsDiv = document.getElementById('report-results');
            resultsDiv.innerHTML = '<h3>Members Report</h3>';
            
            resultsDiv.innerHTML += `<p><strong>Total Members:</strong> ${members.length}</p>`;
            
            // Members table
            if (members.length > 0) {
                resultsDiv.innerHTML += '<table><thead><tr><th>Name</th><th>Phone</th><th>Join Date</th><th>Savings</th><th>Active Loans</th></tr></thead><tbody>';
                members.forEach(member => {
                    const savingsBalance = getMemberSavingsBalance(member.id);
                    const activeLoans = loans.filter(l => l.memberId === member.id && l.status === 'active').length;
                    
                    resultsDiv.innerHTML += `
                        <tr>
                            <td>${member.name}</td>
                            <td>${member.phone}</td>
                            <td>${formatDate(member.joinDate)}</td>
                            <td>${formatCurrency(savingsBalance)}</td>
                            <td>${activeLoans}</td>
                        </tr>
                    `;
                });
                resultsDiv.innerHTML += '</tbody></table>';
            }
        }

        // Helper Functions
        function updateMemberSelects() {
            const memberSelects = [
                document.getElementById('saving-member'),
                document.getElementById('loan-member'),
                document.getElementById('saving-member-filter'),
                document.getElementById('loan-member-filter')
            ];
            
            memberSelects.forEach(select => {
                if (!select) return;
                
                // Save current value
                const currentValue = select.value;
                
                // Clear options (except first if it's a filter)
                select.innerHTML = '';
                if (select.id.includes('filter')) {
                    select.innerHTML = '<option value="">All Members</option>';
                } else {
                    select.innerHTML = '<option value="">Select Member</option>';
                }
                
                // Add member options
                members.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = member.name;
                    select.appendChild(option);
                });
                
                // Restore current value if it still exists
                if (currentValue && members.some(m => m.id === currentValue)) {
                    select.value = currentValue;
                }
            });
        }

        function getMemberName(id) {
            const member = members.find(m => m.id === id);
            return member ? member.name : 'Unknown';
        }

        function getMemberSavingsBalance(id) {
            return savings
                .filter(s => s.memberId === id)
                .reduce((balance, saving) => {
                    if (saving.type === 'deposit') return balance + saving.amount;
                    if (saving.type === 'withdrawal') return balance - saving.amount;
                    return balance;
                }, 0);
        }

        function getMemberSavingsBalanceAtDate(id, date) {
            return savings
                .filter(s => s.memberId === id && new Date(s.date) <= new Date(date))
                .reduce((balance, saving) => {
                    if (saving.type === 'deposit') return balance + saving.amount;
                    if (saving.type === 'withdrawal') return balance - saving.amount;
                    return balance;
                }, 0);
        }

        function calculateDueDate(startDate, termMonths) {
            const date = new Date(startDate);
            date.setMonth(date.getMonth() + termMonths);
            return date.toISOString().split('T')[0];
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        function formatCurrency(amount) {
            return 'ugx ' + new Intl.NumberFormat('en-US', {
                style: 'decimal',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount || 0);
        }
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function confirmAction(title, message, callback) {
            document.getElementById('confirmation-title').textContent = title;
            document.getElementById('confirmation-message').textContent = message;
            confirmationModal.style.display = 'flex';
            
            confirmOkBtn.onclick = function() {
                confirmationModal.style.display = 'none';
                callback();
            };
        }

        function saveData() {
            localStorage.setItem('members', JSON.stringify(members));
            localStorage.setItem('savings', JSON.stringify(savings));
            localStorage.setItem('loans', JSON.stringify(loans));
            localStorage.setItem('transactions', JSON.stringify(transactions));
        }
    </script>
</body>
</html>
